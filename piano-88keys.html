
<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <title>88 keys Piano Simulation</title>
    <link rel="icon" type="image/x-icon" href="./favicons/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon-180x180.png">
    <link href="./css/style.css" rel="stylesheet" />
    <link rel="stylesheet" href="./css/piano-88keys.css" />
    <script type="text/javascript" src="https://unpkg.com/tone"></script>
    <script type="text/javascript" src="./js/include.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
    <script type="text/javascript">
        $(function() {
            include_html('side-bar.html', [["sub", "page"]]);
        });
    </script>
</head>

<body>
    <header>
    <a href="./">Home</a> &gt; <a href="./category-music.html">音楽関連</a> &gt; 88 キーのピアノのテスト
    <h1>88 キーのピアノのテスト</h1>
    </header>

    <div class="two-column">
        <div class="main">

            <p>※あなたはこのピアノは弾けません 
                <span style="font-size: small;">
                &nbsp; (→ ソース 
                <a href="https://github.com/bakkyalo/mypage/blob/master/piano-88keys.html">html</a>
                , 
                <a href="https://github.com/bakkyalo/mypage/blob/master/css/piano-88keys.scss">scss</a>
                )
                &nbsp; 
                <a href="https://github.com/bakkyalo/mypage/tree/master/json">(→ 楽譜の json)</a>
                </span>
            </p>

            <div id="original">
                <tone-keyboard>
                    <tone-keyboard-octave octave="0">
                        <div class="white-notes">
                            <tone-keyboard-note note="9">
                                <button id="A0" class="A0"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="11">
                                <button id="B0" class="B0"></button>
                            </tone-keyboard-note>
                        </div>

                        <div class="black-notes">
                            <tone-keyboard-note note="10">
                                <button id="A#0" class="A#0 Bb0"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="0" class="dummy">
                                <button></button>
                            </tone-keyboard-note>
                        </div>
                    </tone-keyboard-octave> 

                    <tone-keyboard-octave octave="1">
                        <div class="white-notes">
                            <tone-keyboard-note note="12">
                                <button id="C1" class="C1"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="14">
                                <button id="D1" class="D1"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="16">
                                <button id="E1" class="E1"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="17">
                                <button id="F1" class="F1"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="19">
                                <button id="G1" class="G1"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="21">
                                <button id="A1" class="A1"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="23">
                                <button id="B1" class="B1"></button>
                            </tone-keyboard-note>
                        </div>

                        <div class="black-notes">
                            <tone-keyboard-note note="13">
                                <button id="C#1" class="C#1 Db1"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="15">
                                <button id="D#1" class="D#1 Eb1"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="0" class="dummy">
                                <button></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="18">
                                <button id="F#1" class="F#1 Gb1"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="20">
                                <button id="G#1" class="G#1 Ab1"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="22">
                                <button id="A#1" class="A#1 Bb1"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="0" class="dummy">
                                <button></button>
                            </tone-keyboard-note>
                        </div>
                    </tone-keyboard-octave>

                    <tone-keyboard-octave octave="2">
                        <div class="white-notes">
                            <tone-keyboard-note note="24">
                                <button id="C2" class="C2"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="26">
                                <button id="D2" class="D2"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="28">
                                <button id="E2" class="E2"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="29">
                                <button id="F2" class="F2"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="31">
                                <button id="G2" class="G2"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="33">
                                <button id="A2" class="A2"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="35">
                                <button id="B2" class="B2"></button>
                            </tone-keyboard-note>
                        </div>

                        <div class="black-notes">
                            <tone-keyboard-note note="25">
                                <button id="C#2" class="C#2 Db2"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="27">
                                <button id="D#2" class="D#2 Eb2"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="0">
                                <button class="dummy"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="30">
                                <button id="F#2" class="F#2 Gb2"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="32">
                                <button id="G#2" class="G#2 Ab2"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="34">
                                <button id="A#2" class="A#2 Bb2"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="0">
                                <button class="dummy"></button>
                            </tone-keyboard-note>
                        </div>
                    </tone-keyboard-octave>

                    <tone-keyboard-octave octave="3">
                        <div class="white-notes">
                            <tone-keyboard-note note="36">
                                <button id="C3" class="C3"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="38">
                                <button id="D3" class="D3"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="40">
                                <button id="E3" class="E3"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="41">
                                <button id="F3" class="F3"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="43">
                                <button id="G3" class="G3"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="45">
                                <button id="A3" class="A3"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="47">
                                <button id="B3" class="B3"></button>
                            </tone-keyboard-note>
                        </div>

                        <div class="black-notes">
                            <tone-keyboard-note note="37">
                                <button id="C#3" class="C#3 Db3"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="39">
                                <button id="D#3" class="D#3 Eb3"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="0">
                                <button class="dummy"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="42">
                                <button id="F#3" class="F#3 Gb3"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="44">
                                <button id="G#3" class="G#3 Ab3"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="46">
                                <button id="A#3" class="A#3 Bb3"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="0">
                                <button class="dummy"></button>
                            </tone-keyboard-note>
                        </div>
                    </tone-keyboard-octave>

                    <tone-keyboard-octave octave="4">
                        <div class="white-notes">
                            <tone-keyboard-note note="48">
                                <button id="C4" class="C4"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="50">
                                <button id="D4" class="D4"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="52">
                                <button id="E4" class="E4"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="53">
                                <button id="F4" class="F4"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="55">
                                <button id="G4" class="G4"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="57">
                                <button id="A4" class="A4"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="59">
                                <button id="B4" class="B4"></button>
                            </tone-keyboard-note>
                        </div>

                        <div class="black-notes">
                            <tone-keyboard-note note="49">
                                <button id="C#4" class="C#4 Db4"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="51">
                                <button id="D#4" class="D#4 Eb4"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="0">
                                <button class="dummy"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="54">
                                <button id="F#4" class="F#4 Gb4"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="56">
                                <button id="G#4" class="G#4 Ab4"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="58">
                                <button id="A#4" class="A#4 Bb4"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="0">
                                <button class="dummy"></button>
                            </tone-keyboard-note>
                        </div>
                    </tone-keyboard-octave>

                    <tone-keyboard-octave octave="5">
                        <div class="white-notes">
                            <tone-keyboard-note note="60">
                                <button id="C5" class="C5"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="62">
                                <button id="D5" class="D5"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="64">
                                <button id="E5" class="E5"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="65">
                                <button id="F5" class="F5"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="67">
                                <button id="G5" class="G5"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="69">
                                <button id="A5" class="A5"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="71">
                                <button id="B5" class="B5"></button>
                            </tone-keyboard-note>
                        </div>

                        <div class="black-notes">
                            <tone-keyboard-note note="61">
                                <button id="C#5" class="C#5 Db5"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="63">
                                <button id="D#5" class="D#5 Eb5"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="0">
                                <button class="dummy"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="66">
                                <button id="F#5" class="F#5 Gb5"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="68">
                                <button id="G#5" class="G#5 Ab5"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="70">
                                <button id="A#5" class="A#5 Bb5"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="0">
                                <button class="dummy"></button>
                            </tone-keyboard-note>
                        </div>
                    </tone-keyboard-octave>

                    <tone-keyboard-octave octave="6">
                        <div class="white-notes">
                            <tone-keyboard-note note="72">
                                <button id="C6" class="C6"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="74">
                                <button id="D6" class="D6"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="76">
                                <button id="E6" class="E6"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="77">
                                <button id="F6" class="F6"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="79">
                                <button id="G6" class="G6"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="81">
                                <button id="A6" class="A6"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="83">
                                <button id="B6" class="B6"></button>
                            </tone-keyboard-note>
                        </div>

                        <div class="black-notes">
                            <tone-keyboard-note note="73">
                                <button id="C#6" class="C#6 Db6"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="75">
                                <button id="D#6" class="D#6 Eb6"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="0">
                                <button class="dummy"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="78">
                                <button id="F#6" class="F#6 Gb6"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="80">
                                <button id="G#6" class="G#6 An6"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="82">
                                <button id="A#6" class="A#6 Bb6"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="0">
                                <button class="dummy"></button>
                            </tone-keyboard-note>
                        </div>
                    </tone-keyboard-octave>

                    <tone-keyboard-octave octave="7">
                        <div class="white-notes">
                            <tone-keyboard-note note="84">
                                <button id="C7" class="C7"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="86">
                                <button id="D7" class="D7"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="88">
                                <button id="E7" class="E7"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="89">
                                <button id="F7" class="F7"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="91">
                                <button id="G7" class="G7"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="93">
                                <button id="A7" class="A7"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="95">
                                <button id="B7" class="B7"></button>
                            </tone-keyboard-note>
                        </div>

                        <div class="black-notes">
                            <tone-keyboard-note note="85">
                                <button id="C#7" class="C#7 Bb7"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="87">
                                <button id="D#7" class="D#7 Eb7"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="0">
                                <button class="dummy"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="90">
                                <button id="F#7" class="F#7 Gb7"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="92">
                                <button id="G#7" class="G#7 Ab7"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="94">
                                <button id="A#7" class="A#7 Bb7"></button>
                            </tone-keyboard-note>
                            <tone-keyboard-note note="0">
                                <button class="dummy"></button>
                            </tone-keyboard-note>
                        </div>
                    </tone-keyboard-octave>

                    <tone-keyboard-octave octave="8">
                        <div class="white-notes">
                            <tone-keyboard-note note="96">
                                <button id="C8" class="C8"></button>
                            </tone-keyboard-note>
                        </div>

                    </tone-keyboard-octave>
                </tone-keyboard>
            </div>

            <br>
            <input type="button" value="Play" id="playButton">
            <input type="button" value="Stop" id="stopButton">
            <select id="selectMusic">
                <option value="mondschein3">Mondschein III - Ludwig van Beethoven (First 14 bars)</option>
                <option value="etuden10-4">Etuden Op.10-4 - Frederic Chopin (First 29 bars)</option>
                <option value="skyhigh">Skyhigh - Kirby Super Star</option>
                <option value="twinkleStarDdur">Twinkle, Twinkle, Little Star (D dur)</option>
            </select>

        </div>

        <div class="side">
            <div id="page">dst</div>
        </div>

    </div>

    <script>
        // ボタンの定義
        const playButton = document.getElementById("playButton");
        const stopButton = document.getElementById("stopButton");

        stopButton.style.display = "none";


        // ここに addEventListener 書くのキモくね？
        // Play button が押された時の操作
        playButton.addEventListener("click", function() {
            playButton.style.display = "none";
            stopButton.style.display = "inline-block";

            // プルダウンメニュー操作
            const selectedMusic = document.getElementById("selectMusic").value;
            const jsonURL = `./json/${selectedMusic}.json`;
            // console.log(jsonURL);
            
            // JSON の楽譜を取り出す
            // fetch("./json/mondschein3.json")
            // fetch("./json/skyhigh.json")
            fetch(jsonURL)
                .then( response => {
                    if(!response.ok) {
                        throw new Error(`Network response was not ok: ${response.status}`);
                    }
                    return response.json();
                })
                .then( json => {
                    const rightHandScore = json.rightHandScore;
                    const leftHandScore = json.leftHandScore;
                    const tempo = json.tempo;
                    
                    const piano = new Tone.Sampler({
                        urls: {
                            A0: "A0.mp3",
                            C1: "C1.mp3",
                            "D#1": "Ds1.mp3",
                            "F#1": "Fs1.mp3",
                            A1: "A1.mp3",
                            C2: "C2.mp3",
                            "D#2": "Ds2.mp3",
                            "F#2": "Fs2.mp3",
                            A2: "A2.mp3",
                            C3: "C3.mp3",
                            "D#3": "Ds3.mp3",
                            "F#3": "Fs3.mp3",
                            A3: "A3.mp3",
                            C4: "C4.mp3",
                            "D#4": "Ds4.mp3",
                            "F#4": "Fs4.mp3",
                            A4: "A4.mp3",
                            C5: "C5.mp3",
                            "D#5": "Ds5.mp3",
                            "F#5": "Fs5.mp3",
                            A5: "A5.mp3",
                            C6: "C6.mp3",
                            "D#6": "Ds6.mp3",
                            "F#6": "Fs6.mp3",
                            A6: "A6.mp3",
                            C7: "C7.mp3",
                            "D#7": "Ds7.mp3",
                            "F#7": "Fs7.mp3",
                            A7: "A7.mp3",
                            C8: "C8.mp3",
                        },
                        baseUrl: "https://tonejs.github.io/audio/salamander/", 
                        onload: () => {
                        
                            // 右手
                            const rightHandPart = new Tone.Part(((time, note) => {
                                piano.triggerAttackRelease(note.note, note.duration, time, note.velocity);
                            
                                // 鍵盤に反映させる
                                // 単音の場合
                                if(!(note.note instanceof Array)) {
                                    const keyElem = document.getElementsByClassName(note.note)[0];
                                    const computedStyle = window.getComputedStyle(keyElem);
                                    let previousBGColor = computedStyle.backgroundColor;
                                    if (note.note.includes("#") || note.note.includes("b")) {
                                        previousBGColor = "black";
                                        keyElem.style.backgroundColor = "#2ab8c8";
                                    } else {
                                        previousBGColor = "white";
                                        keyElem.style.backgroundColor = "#51dff2";
                                    }
                                
                                
                                    const noteLengthInSeconds = Tone.Time(note.duration).toSeconds();
                                    setTimeout( () => {
                                        keyElem.style.backgroundColor = previousBGColor;
                                    }, noteLengthInSeconds * 1000);
                                }
                                // 和音の場合
                                else {
                                    for (let i = 0; i < note.note.length; i++) {
                                        const keyElem = document.getElementsByClassName(note.note[i])[0];
                                        const computedStyle = window.getComputedStyle(keyElem);
                                        let previousBGColor = computedStyle.backgroundColor;
                                        if (note.note[i].includes("#") || note.note[i].includes("b")) {
                                            previousBGColor = "black";
                                            keyElem.style.backgroundColor = "#2ab8c8";
                                        } else {
                                            previousBGColor = "white";
                                            keyElem.style.backgroundColor = "#51dff2";
                                        }
                                    
                                    
                                        // duration も配列かどうかで分かれる
                                        if (!(note.duration instanceof Array)) {
                                            const noteLengthInSeconds = Tone.Time(note.duration).toSeconds();
                                            setTimeout( () => {
                                                keyElem.style.backgroundColor = previousBGColor;
                                            }, noteLengthInSeconds * 1000);
                                        }
                                        else {
                                            const noteLengthInSeconds = Tone.Time(note.duration[i]).toSeconds();
                                            setTimeout( () => {
                                                keyElem.style.backgroundColor = previousBGColor;
                                            }, noteLengthInSeconds * 1000);
                                        }
                                    
                                    }
                                }
                            }), rightHandScore).start();
                        
                        
                            // 左手
                            const leftHandPart = new Tone.Part(((time, note) => {
                                piano.triggerAttackRelease(note.note, note.duration, time, note.velocity);
                            
                                // 鍵盤に反映させる
                                // 単音の場合
                                if(!(note.note instanceof Array)) {
                                    const keyElem = document.getElementsByClassName(note.note)[0];
                                    const computedStyle = window.getComputedStyle(keyElem);
                                    let previousBGColor = computedStyle.backgroundColor;
                                    if (note.note.includes("#") || note.note.includes("b")) {
                                        previousBGColor = "black";
                                        keyElem.style.backgroundColor = "#6ec578";
                                    } else {
                                        previousBGColor = "white";
                                        keyElem.style.backgroundColor = "#92eca2";
                                    }
                                
                                
                                    const noteLengthInSeconds = Tone.Time(note.duration).toSeconds();
                                    setTimeout( () => {
                                        keyElem.style.backgroundColor = previousBGColor;
                                    }, noteLengthInSeconds * 1000);
                                }
                                // 和音の場合
                                else {
                                    for (let i = 0; i < note.note.length; i++) {
                                        const keyElem = document.getElementsByClassName(note.note[i])[0];
                                        const computedStyle = window.getComputedStyle(keyElem);
                                        let previousBGColor = computedStyle.backgroundColor;
                                        if (note.note[i].includes("#") || note.note[i].includes("b")) {
                                            previousBGColor = "black";
                                            keyElem.style.backgroundColor = "#6ec578";
                                        } else {
                                            previousBGColor = "white";
                                            keyElem.style.backgroundColor = "#92eca2";
                                        }
                                    
                                    
                                        // duration も配列かどうかで分かれる
                                        if (!(note.duration instanceof Array)) {
                                            const noteLengthInSeconds = Tone.Time(note.duration).toSeconds();
                                            setTimeout( () => {
                                                keyElem.style.backgroundColor = previousBGColor;
                                            }, noteLengthInSeconds * 1000);
                                        }
                                        else {
                                            const noteLengthInSeconds = Tone.Time(note.duration[i]).toSeconds();
                                            setTimeout( () => {
                                                keyElem.style.backgroundColor = previousBGColor;
                                            }, noteLengthInSeconds * 1000);
                                        }
                                    
                                    }
                                }
                            }), leftHandScore).start();

                            Tone.Transport.start();
                        }
                    
                    }).toDestination();
                
                    Tone.Transport.bpm.value = tempo;
                
                })
                    
                .catch( error => {
                    console.error("Fetch Error:", error);
                });

            })

        stopButton.addEventListener("click", function() {
            stopButton.style.display = "none";
            playButton.style.display = "inline-block";

            Tone.Transport.stop();
            Tone.Transport.cancel();

        });
        // const data = JSON.parse(rawData);


    </script>


</body>
<footer>
    Powered by GitHub Pages<br>
    (C) bakkyalo
</footer>

</html>